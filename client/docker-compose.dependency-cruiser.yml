#run this with:     docker compose -f docker-compose.dependency-cruiser.yml up
services:
  depcruise:
    build:
      context: .
      dockerfile_inline: |
        FROM node:20-alpine
        RUN apk add --no-cache graphviz
        WORKDIR /app
        COPY package.json package-lock.json* ./
        RUN npm ci
        COPY . .
        CMD ["sh", "-c", "npx depcruise src --include-only '^src' --output-type dot | dot -T svg > /output/dependency-graph.svg && echo 'Dependency graph generated successfully at dependency-graph.svg'"]
    volumes:
      - ./:/output